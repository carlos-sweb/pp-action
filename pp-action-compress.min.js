"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ownKeys(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(t){var r="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self.self===self&&self||"object"==("undefined"==typeof global?"undefined":_typeof(global))&&global.global===global&&global;"function"==typeof define&&define.amd?define(["exports"],function(e){r.ppView=t(),module.exports=r.ppView}):"undefined"!=typeof exports?t():r.ppView=t()}(function(e,t){function s(e){return!y(e,"required")||""!=e.value}function c(e){var t=!0,r=v(e,"$valid","$dirty");for(var i in r)t=t&&r[i].$valid;return t}function o(e,t){e.removeAttribute(t)}function l(e,t,r){e.setAttribute(t,r)}function f(e,t){return y(e,t)?e.getAttribute(t):""}function u(e,t){return e.querySelectorAll(t)}function d(r,i){var n;return function(){n&&clearTimeout(n);var e=this,t=arguments;n=setTimeout(function(){r.apply(e,t)},i)}}function h(e){var t=f(e,p),r=f(e,"pp-model-debounce"),i=f(e,"pp-data-form"),n=y(e,"type")?e.type.toLowerCase():"";return{model:t,debounceTime:null==r?0:r,debounceValue:parseInt(null==r?0:r),type:n,form:i}}var p="pp-model",m={window:["afterprint","beforeprint","beforeunload","error","hashchange","load","message","offline","online","pagehide","pageshow","popstate","resize","storage","unload"],mouse:["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","wheel"],keyboard:["keydown","keypress","keyup"],drag:["drag","dragend","dragenter","dragleave","dragover","dragstart","drop","scroll"],clipboard:["copy","cut","paste"],media:[],form:["blur","change","contextmenu","focus","input","invalid","reset","search","select","submit"]},y=function(e,t){return e.hasAttribute(t)},v=function(){var e=[].slice.call(arguments),t={};if(1<e.length){var r=e[0];return e.shift(),"object"==_typeof(r)&&(t=_objectSpread({},r),e.forEach(function(e){"string"==typeof e&&r.hasOwnProperty(e)&&delete t[e]})),Object.assign(_objectSpread({},t),{})}return t};return function(e){var t=this;this.saferEval=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return new Function(["$data"].concat(_toConsumableArray(Object.keys(r))),"var result; with($data) { result = ".concat(e," };return result")).bind(this).apply(void 0,[t].concat(_toConsumableArray(Object.values(r))))},this.events={},this.on=function(e,t){"string"==typeof e&&"function"==typeof t&&(this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t))},this.removeListener=function(e,t){_typeof(this.events[e])},this.emit=function(e){var t,r,i,n=[].slice.call(arguments,1);if("object"===_typeof(this.events[e]))for(i=(r=this.events[e].slice()).length,t=0;t<i;t++)r[t].apply(this,n)},this.el=document.querySelector(e.el||null),this.watch=e.watch||{},this.form=e.form||{},this.$form={},this.data=e.data||{},this.methods=e.methods||{},this.filters=e.filters||{},this.template=e.template||null,this.el.innerHTML=this.template,this.detectingChangeData=function(e,t){for(var r=Object.keys(e),i=0;i<r.length;i++){var n=r[i];if(!e.hasOwnProperty(n)){this.watch.hasOwnProperty(n)&&"function"==typeof this.watch[n]&&this.watch[n](e[n],this.data[n],t),this.emit("dataChange");break}if(e[n]!=this.data[n]){this.watch.hasOwnProperty(n)&&"function"==typeof this.watch[n]&&this.watch[n](e[n],this.data[n],t),this.emit("dataChange");break}}},this.handleFormDirective=function(t){var r,i=this;y(t,"name")&&(t.addEventListener("submit",function(e){y(t,"pp-submit-prevent")&&e.preventDefault()}),t.addEventListener("reset",function(e){console.log("Escucnahdo reset")}),"string"==typeof(r=f(t,"name"))&&""!=r&&(this.$form.hasOwnProperty(r)||(this.$form[r]={$valid:!0,$dirty:!1},this.$form[r].$valid=c(this.$form[r])),Array.from(t.querySelectorAll("[pp-text],[pp-show],[pp-class],[pp-model],[pp-click],[pp-disabled]")).forEach(function(e){return!e.hasAttribute("pp-data-form")&&e.setAttribute("pp-data-form",r)}),Array.from(t.querySelectorAll("input[pp-model],select[pp-model],textarea[pp-model]")).forEach(function(e){var t;!e.hasAttribute(p)||"string"==typeof(t=e.getAttribute(p))&&""!=t&&i.data.hasOwnProperty(t)&&(i.$form[r][t]={$required:y(e,"required"),$valid:s(e),$dirty:!1,$value:e.value},i.$form[r].$valid=c(i.$form[r]))})))},this.handleRequiredDirective=function(e,n){var t;"boolean"==typeof n&&-1!=["INPUT","TEXTAREA"].indexOf(e.tagName)&&(t=function(e,t){var r=f(e,"pp-data-form"),i=f(e,p);this.$form.hasOwnProperty(r)&&this.$form[r].hasOwnProperty(i)&&this.$form[r][i][t]!=n&&(this.$form[r][i][t]=n,this.emit("dataChange"))},1==n&&0==y(e,"required")&&(l(e,"required"),t.bind(this)(e,"$required")),0==n&&1==e.hasAttribute("required")&&(o(e,"required"),t.bind(this)(e,"$required")))},this.handleReadonlyDirective=function(e,t){"boolean"==typeof t&&-1!=["INPUT","TEXTAREA"].indexOf(e.tagName)&&(t?l(e,"readonly",""):o(e,"readonly"))},this.handleDisabledDirective=function(e,t){"boolean"==typeof t&&-1!=["INPUT","SELECT","BUTTON","TEXTAREA"].indexOf(e.tagName)&&(t?l(e,"disabled",""):o(e,"disabled"))},this.handleTextDirective=function(e,t){var r=e.innerText;("function"==typeof t?t():t)!=r&&(e.innerText="function"==typeof t?t():t)},this.handleHtmlDirective=function(e,t){e.innerHTML;e.innerHTML="function"==typeof t?t():t,this.initialize(e)},this.handleShowDirective=function(e,t){e.style.display=t?"":"none"},this.initializeModel=function(e){var r=this;e=e||this.el,u(e,"input[pp-model],select[pp-model],textarea[pp-model]").forEach(function(e){var t=e.tagName;"INPUT"==t&&r.modelInput(e),"SELECT"==t&&r.modelSelect(e)})},this.modelSelect=function(e){var t=this,r=h(e),i=r.model,n=(r.debounceTime,r.debounceValue);r.form;u(e,"option").forEach(function(e){e.value==t.data[i].toString()?l(e,"selected",""):y(e,"selected")&&o(e,"selected")});var a=d(function(e){switch(e.target.getAttribute("pp-model-format")){case null:t.data[i]=e.target.value;break;case"string":t.data[i]=e.target.value.toString();break;case"number":t.data[i]=parseInt(e.target.value)}t.emit("dataChange")},n);e.addEventListener("change",a)},this.modelInput=function(t){var i=this,e=h(t),r=e.model,n=(e.debounceTime,e.debounceValue),a=e.type,o=e.form;this.data.hasOwnProperty(r)&&(t.value=this.data[r].toString(),this.$form.hasOwnProperty(o)&&this.$form[o].hasOwnProperty(r)&&(this.$form[o][r].$value=t.value,this.$form[o].$valid=c(this.$form[o])));var l=d(function(e){if(i.data[r].toString()!==e.target.value){if(i.watch.hasOwnProperty(r)&&"function"==typeof i.watch[r])try{i.watch[r](e.target.value,i.data[r],e)}catch(e){console.log(e)}switch(a){case"text":i.data[r]=e.target.value,i.$form.hasOwnProperty(o)&&i.$form[o].hasOwnProperty(r)&&(i.$form[o][r].$value=e.target.value,i.$form[o][r].$valid=s(e.target),i.$form[o][r].$dirty||(i.$form[o][r].$dirty=!0),i.$form[o].$valid=c(i.$form[o]))}i.emit("dataChange")}},n);m.keyboard.forEach(function(e){t.addEventListener(e,l)}),t.addEventListener("change",function(e){console.log(e),console.log("Change")}),t.addEventListener("blur",function(e){var t=f(e.target,"pp-data-form"),r=f(e.target,p);i.$form[t][r].$dirty||(i.$form[t][r].$dirty=!0,i.emit("dataChange"))})},this.modelSetValue=function(e){var n=this,e=e||this.el;Object.values(Array.from(this.el.querySelectorAll("[pp-model]"))).forEach(function(e){var t=h(e),r=t.form,i=t.model;-1!=["INPUT","SELECT","TEXTAREA"].indexOf(e.tagName)&&n.data.hasOwnProperty(i)&&e.value!=n.data[i].toString()&&(e.value=n.data[i],n.$form.hasOwnProperty(r)&&n.$form[r].hasOwnProperty(i)&&(n.$form[r][i].$value=n.data[i],n.$form[r][i].$valid=s(e),n.$form[r].$valid=c(n.$form[r])))})},this.initializeDirectivesComplex=function(e){},this.initializeDirectives=function(e){var c=this,e=e||this.el;["text","html","show","disabled","readonly","required"].forEach(function(s){u(e,"[pp-"+s+"]").forEach(function(e){var t=f(e,"pp-"+s);if(""!=t&&null!=t){var r=t.split("|").map(function(e){return e.trim()}),i="",n=e.getAttribute("pp-data-form"),a=void 0;null!=n&&c.$form.hasOwnProperty(n)&&(a=c.$form[n]);try{if(i=c.saferEval(r[0],_objectSpread(_objectSpread({},c.data),{$form:a}),c.methods),1<r.length)for(var o=1;o<r.length;o++){var l=r[o];c.filters.hasOwnProperty(l)&&"string"==typeof i&&(i=c.filters[l](i))}}catch(e){console.warn(e)}"text"==s&&c.handleTextDirective(e,i),"show"==s&&c.handleShowDirective(e,i),"disabled"==s&&c.handleDisabledDirective(e,i),"readonly"==s&&c.handleReadonlyDirective(e,i),"required"==s&&c.handleRequiredDirective(e,i),"html"==s&&c.handleHtmlDirective(e,i),"maxlength"==s&&c.handleHtmlDirective(e,i),"maxlength"==s&&c.handleHtmlDirective(e,i)}})})},this.HelperFunctionInitialize=function(e,t){var r=e.target,i=f(r,t),n=_objectSpread({},this.data),a=f(r,"pp-data-form"),o=null;this.$form.hasOwnProperty(a)&&(o=this.$form[a]);var l=Object.assign(_objectSpread({},this.data),{$el:r,$event:e,$form:o});try{this.saferEval(i,l,this.methods)}catch(e){console.log(e)}this.data=_objectSpread({},v(l,"$el","$event")),this.detectingChangeData(n,e)};function n(r,i,n){return function e(t){r.HelperFunctionInitialize(t,i),n&&t.target.removeEventListener(t.type,e)}}this.initialize=function(e){var i=this,t=Date.now(),e=e||this.el;(function(){var e=[];for(var t in m)e=e.concat(m[t]);return e})().forEach(function(r){u(e,"[pp-"+r+"]").forEach(function(e){var t="pp-"+r;f(e,t);e.addEventListener(r,n(i,t,!1))}),u(e,"[pp-"+r+"-once]").forEach(function(e){var t="pp-"+r+"-once";f(e,t);e.addEventListener(r,n(i,t,!0))})}),u(e,"[pp-form]").forEach(function(e){l(e,"pp-data-form",f(e,"name")),i.handleFormDirective(e)}),this.initializeModel(e),this.initializeDirectivesAll(e),console.log(Date.now()-t)},this.initializeDirectivesAll=function(e){this.initializeDirectivesComplex(e),this.initializeDirectives(e)},this.on("dataChange",function(){t.modelSetValue(t.el),t.initializeDirectivesAll(t.el)}),this.initialize(this.el),this.emit("finished")}});